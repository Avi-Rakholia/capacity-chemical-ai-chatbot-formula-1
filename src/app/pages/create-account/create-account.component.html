<div class="container d-flex justify-content-center py-5">
   <div class="create-account-card card p-5 shadow-sm">
      <div class="text-center mb-3">
         <img src="assets/capacity-chemical-logo.svg" alt="Logo" class="logo-img" />
      </div>
      <h1 class="text-center display-6 fw-semibold text-muted mb-1">Create Account</h1>
      <p class="text-center text-muted mb-4">
         Already have an account?
         <a class="text-decoration-underline text-muted" (click)="navigateToLogin()" role="button">Log In</a>
      </p>
      <form [formGroup]="createAccountForm" (ngSubmit)="onSubmit()" novalidate>
      @if (errorMessage()) {
      <div class="alert alert-danger" role="alert">
         {{ errorMessage() }}
      </div>
      }
      @if (successMessage()) {
      <div class="alert alert-success" role="alert">
         {{ successMessage() }}
      </div>
      }
      <div class="mb-4">
         <label class="form-label text-muted d-block mb-2">Who are you?</label>
         <div class="d-flex align-items-center gap-4 role-options">
            <div class="form-check">
               <input
                  class="form-check-input"
                  type="radio"
                  id="roleNsight"
                  value="nsight"
                  formControlName="role"
                  />
               <label class="form-check-label text-muted" for="roleNsight">Nsight Admin</label>
            </div>
            <div class="form-check">
               <input
                  class="form-check-input"
                  type="radio"
                  id="roleCapacity"
                  value="capacity"
                  formControlName="role"
                  />
               <label class="form-check-label text-muted" for="roleCapacity">Capacity Admin</label>
            </div>
            <div class="form-check">
               <input
                  class="form-check-input"
                  type="radio"
                  id="roleUser"
                  value="user"
                  formControlName="role"
                  />
               <label class="form-check-label text-muted" for="roleUser">User</label>
            </div>
         </div>
      </div>
      <div class="mb-3">
         <label for="email" class="form-label text-muted">Email</label>
         <input
            id="email"
            class="form-control form-control-lg rounded-3"
            type="email"
            placeholder="abc@capacitychemical.com"
            formControlName="email"
            [class.is-invalid]="createAccountForm.get('email')?.invalid && createAccountForm.get('email')?.touched"
            />
         @if (createAccountForm.get('email')?.invalid && createAccountForm.get('email')?.touched) {
         <div class="invalid-feedback">
            @if (createAccountForm.get('email')?.hasError('required')) {
            Email is required
            }
            @if (createAccountForm.get('email')?.hasError('email')) {
            Please enter a valid email address
            }
         </div>
         }
      </div>
      <div class="mb-3">
         <label for="username" class="form-label text-muted">Username</label>
         <input
            id="username"
            class="form-control form-control-lg rounded-3"
            type="text"
            placeholder="Username"
            formControlName="username"
            [class.is-invalid]="createAccountForm.get('username')?.invalid && createAccountForm.get('username')?.touched"
            />
         @if (createAccountForm.get('username')?.invalid && createAccountForm.get('username')?.touched) {
         <div class="invalid-feedback">
            @if (createAccountForm.get('username')?.hasError('required')) {
            Username is required
            }
            @if (createAccountForm.get('username')?.hasError('minlength')) {
            Username must be at least 3 characters long
            }
         </div>
         }
      </div>
      <div class="mb-2 position-relative password-section">
         <label for="password" class="form-label text-muted">Password</label>
         <input
            id="password"
            class="form-control form-control-lg rounded-3"
            [type]="passwordVisible() ? 'text' : 'password'"
            placeholder="Password"
            formControlName="password"
            />
         <button
            type="button"
            class="btn btn-sm btn-link position-absolute password-toggle"
            aria-label="toggle password visibility"
            (click)="togglePasswordVisibility()"
            >
         {{ passwordVisible() ? 'Hide' : 'Show' }}
         </button>
      </div>
      @if (createAccountForm.get('password')?.touched && createAccountForm.get('password')?.errors) {
      <div class="invalid-feedback d-block mb-2">
         @if (createAccountForm.get('password')?.errors?.['minLength']) {
         <div>Use 8 or more characters</div>
         }
         @if (createAccountForm.get('password')?.errors?.['uppercase']) {
         <div>One uppercase character required</div>
         }
         @if (createAccountForm.get('password')?.errors?.['lowercase']) {
         <div>One lowercase character required</div>
         }
         @if (createAccountForm.get('password')?.errors?.['number']) {
         <div>One numeric character required</div>
         }
         @if (createAccountForm.get('password')?.errors?.['specialChar']) {
         <div>One special character required</div>
         }
      </div>
      }
      <div class="mb-2 position-relative password-section">
         <label for="confirmPassword" class="form-label text-muted">Confirm Password</label>
         <input
            id="confirmPassword"
            class="form-control form-control-lg rounded-3"
            [type]="confirmPasswordVisible() ? 'text' : 'password'"
            placeholder="Confirm Password"
            formControlName="confirmPassword"
            />
         <button
            type="button"
            class="btn btn-sm btn-link position-absolute password-toggle"
            aria-label="toggle confirm password visibility"
            (click)="toggleConfirmPasswordVisibility()"
            >
         {{ confirmPasswordVisible() ? 'Hide' : 'Show' }}
         </button>
      </div>
      @if (createAccountForm.errors?.['passwordMismatch'] && createAccountForm.get('confirmPassword')?.touched) {
      <div class="invalid-feedback d-block">
         Passwords do not match
      </div>
      }
      <div class="password-rules-container mb-3">
         <div class="d-flex flex-wrap gap-3">
            <span class="rule-item">Use 8 or more characters</span>
            <span class="rule-item">One uppercase character</span>
            <span class="rule-item">One lowercase character</span>
         </div>
         <div class="d-flex flex-wrap gap-3 mt-2">
            <span class="rule-item">One special character</span>
            <span class="rule-item">One numeric character</span>
         </div>
      </div>
      <p class="small text-center text-muted mb-4">
         By creating an account, you agree to the
         <a href="#" class="text-decoration-underline text-muted">Terms of use</a> and
         <a href="#" class="text-decoration-underline text-muted">Privacy policy</a>
      </p>
      <div class="text-center">
         <button
            type="submit"
            class="btn btn-primary rounded-pill"
            [disabled]="createAccountForm.invalid || isLoading()"
            >
         @if (isLoading()) {
         <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
         Creating Account...
         } @else {
         Create Account
         }
         </button>
      </div>
      </form>
      <div class="text-center mt-2">
         <div class="mt-3">Or Sign up with</div>
         <div class="d-flex justify-content-center align-items-center gap-2 mt-2">
            <button 
            type="button" 
            class="btn btn-outline-secondary d-flex align-items-center gap-2"
            (click)="signUpWithMicrosoft()"
            [disabled]="isLoading()"
            >
            <img src="assets/m365.png" alt="Microsoft 365" class="m365-img" />
            <span>Microsoft 365</span>
            </button>
         </div>
      </div>
   </div>
</div>